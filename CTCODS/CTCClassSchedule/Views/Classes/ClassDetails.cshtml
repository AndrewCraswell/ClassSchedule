@using CTCClassSchedule;
@using CTCClassSchedule.Common;
@using MvcMiniProfiler;
@using Ctc.Ods.Types;
@model IEnumerable<CTCClassSchedule.SectionWithSeats>

@{
	MiniProfiler _profiler = MiniProfiler.Current;

	Section course = (Section)ViewBag.CourseInfo;
	IList<YearQuarter> yrqList = (ViewBag.QuarterNavMenu as IList<YearQuarter>);
	string currentYrq = yrqList[0].ID;

	string PreviousYrq = string.Empty;
}

<script type="text/javascript" src="@Url.Content("~/Scripts/CtcClassSchedule.js")"></script>

<div id="scheduleMain">
	@Html.Partial("quarterNavigation")
	<div id="scheduleContentNoSidebar">
        <div id="class-details">
			    <h1 class="course-title">
				    <span class="courseID">@course.CourseSubject @course.CourseNumber</span>
						<span>@course.CourseTitle</span>
						<span>&#8226; @Html.CreditsValue(course.Credits)

					    <abbr title="Credit(s) ">
						    Cr.</abbr></span></h1>

			    <p class="prerequisite">
			    </p>
			    <div id="courseDescription">
				    <h2>Description:</h2>
                    <p>
				    @(course.CourseDescriptions.Count <= 0 || string.IsNullOrWhiteSpace(course.CourseDescriptions[0].Description) ? "* NO DESCRIPTION FOUND *" : course.CourseDescriptions[0].Description)
			        </p>
                </div>

		    @if (!string.IsNullOrWhiteSpace(ViewBag.CourseOutcome))
		    {
			    <div id="courseOutcome">
				    <h2>Outcomes:</h2>
				    @Html.Raw(ViewBag.CourseOutcome)
			    </div>
		    }

				@using (_profiler.Step("Rendering sections by YRQ"))
		{
			foreach (YearQuarter yrq in yrqList)
			{
				string thisYrq = yrq.ID;

			  <h2 class="course-YRQ@(currentYrq != thisYrq ? Html.Raw(" course-YRQ-past-quarter") : Html.Raw(string.Empty))">@yrq.FriendlyName</h2>
			  <div class="YRQClassTitle">@course.CourseSubject @course.CourseNumber - @course.CourseTitle &#8226; @Html.CreditsValue(course.Credits) <abbr title="Credit(s) ">Cr.</abbr></div>

				<ul class="course-block@(currentYrq != thisYrq ? Html.Raw(" course-block-past-quarter") : Html.Raw(string.Empty))">

				@Html.Partial("Sections", Model.Where(s => s.Yrq.ID == thisYrq))

				</ul>
			}
		}
	    </div> <!-- class-details -->

        <div id="scheduleRightSidebar">

            <div id="programWebsite">
                <h2>Department</h2>
			    <p><a href="@ViewBag.ProgramUrl" class="programWebsite">Program Website</a></p>
		    </div>

       </div><!-- scheduleRightSidebar -->
    </div>
</div>

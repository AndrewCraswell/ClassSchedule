@using CTCClassSchedule
@using CTCClassSchedule.Common
@using CTCClassSchedule.Controllers
@using MvcMiniProfiler;
@using Ctc.Ods.Types
@model IList<CTCClassSchedule.SectionWithSeats>
@{
	MiniProfiler _profiler = MiniProfiler.Current;

	IDictionary<string, object> _routeValues = ViewBag.RouteValues;
	_routeValues["YearQuarterID"] = "All";
	_routeValues["Subject"] = Model.Count > 0 ? Model.First().CourseSubject.Trim() : null;
	RouteValueDictionary route = new RouteValueDictionary(_routeValues);


	string courseID = string.Empty;
	string sectionID = string.Empty;
    decimal credits = 0;
	string PreviousCourseID = string.Empty;
	string PreviousSectionID = string.Empty;
    decimal PreviousCredits = 0;
	string FriendlyYRQ = string.Empty;
	string thisYrq = string.Empty;

    IList<SectionWithSeats> orderedModel = Model.OrderBy(s => s.CourseNumber).ThenBy(s => s.Credits).ToList();
	IList<YearQuarter> yrqList = (ViewBag.QuarterNavMenu as IList<YearQuarter>);
	string currentYrq = yrqList[0].ID;

	if (ViewBag.YearQuarter != null)
	{
		YearQuarter yrq = ViewBag.YearQuarter;
		thisYrq = yrq.ID;
		FriendlyYRQ = yrq.FriendlyName;
	}

ViewBag.PageTitle = FriendlyYRQ + " " + ViewBag.ProgramTitle + " Credit Class Schedule at Bellevue College";

}
<script type="text/javascript" src="@Url.Content("~/Scripts/CtcClassSchedule.js")"></script>
<div id="scheduleMain">
	@{
			Html.RenderPartial("quarterNavigation");
	}
	<div id="container" class="sidebar">
		<div id="sidebar">
			@{
							Html.RenderPartial("advancedFacetedSearch");
							Html.RenderPartial("basicFacetedSearch");
			}
		</div>
		<!-- #sidebar -->
		<div id="content">
			@if (Model.Count == 0)
	{
				<h1>
					No classes found.</h1>
	}
	else
	{
				<h1 id="pageTitle">
					@ViewBag.ProgramTitle
					<span class="subjectchooser">@Html.Partial("subjectNavigation")</span>
				</h1>

															 if (!string.IsNullOrWhiteSpace(ViewBag.ProgramUrl))
															 {
				<p id="programWebsite">
					<a href="@ViewBag.ProgramUrl" class="programWebsite">Program Website</a>
				</p>
															 }

															 using (_profiler.Step("Rendering Sections by Course (outer loop)"))
															 {
                                                                 foreach (SectionWithSeats sec in orderedModel)
																 {
																	 courseID = sec.CourseID;
																	 sectionID = sec.ID.ToString();
                                                                     credits = sec.Credits;

                                                                     if (courseID != PreviousCourseID || (courseID == PreviousCourseID && credits != PreviousCredits))
																	 {
																		 if (PreviousCourseID != "")
																		 {
				@:</ul>
					}

																		 route["Subject"] = sec.CourseSubject.Trim();
																		 route["ClassNum"] = sec.CourseNumber;

				<text>
				<h2 class="classHeading">
					<a href="@Url.Action("ClassDetails", "Classes", route)">
						@Html.Raw(string.Format("{0}{1} {2} {3} &#8226; {4} Cr.", sec.CourseSubject, sec.IsCommonCourse ? "&" : string.Empty, sec.CourseNumber, sec.CourseTitle, Html.CreditsValue(sec.Credits)))
					</a>
				</h2>
				<div class="CourseFootnotes">
					@sec.CourseFootnotes
				</div>
				<p class="classDetails">
					@Html.ActionLink("View class details", "ClassDetails", "Classes", route, null)
				</p>
				<ul class='course-block@(currentYrq != thisYrq ? Html.Raw(" course-block-past-quarter") : Html.Raw(string.Empty))'>
				</text>
																	 }

																	 if (PreviousSectionID != sectionID)
																	 {
																		 Html.RenderPartial("Sections", sec, new ViewDataDictionary { { "PreviousSectionID", PreviousSectionID } });
																	 }

                                                                     PreviousCredits = sec.Credits;
																	 PreviousSectionID = sectionID;
																	 PreviousCourseID = courseID;
																 }
															 }
	}


<script type="text/javascript">
	/* subject chooser pop-up dialog */
	$(document).ready(function () {

		$("#edit-section").dialog({
			autoOpen: false,
			height: 400,
			width: 500,
		});
	});
</script>

	<div title="Edit Section" id="edit-section"></div>

		</div>
		<!-- content -->
	</div>
	<!-- container -->
</div>
<!-- #scheduleMain -->
